\documentclass[aps,prl,preprint]{revtex4-2}
\usepackage{amsmath}
\usepackage{physics}

\begin{document}

\title{Title of Your Paper}
\author{Your Name}
\affiliation{Your Institution}
\date{\today}

\begin{abstract}
    Your abstract goes here.
\end{abstract}

% \maketitle
\section{Mean-field theory}
The mean-field Nambu-Gor'kov Hamiltonian is
\begin{align}
    H
     & = \frac{1}{2}\iint\dd[3]\vb{r}\dd[3]\vb{r}'
    \widehat{\Psi}^\dagger(\vb{r}')
    \begin{pmatrix}
        \xi(\vb{r})\delta(\vb{r}-\vb{r}')\hat{1} & \hat{\Delta}(\vb{r},\vb{r}')              \\
        \hat{\Delta}^\dagger(\vb{r},\vb{r}')     & -\xi(\vb{r})\delta(\vb{r}-\vb{r}')\hat{1}
    \end{pmatrix}
    \widehat{\Psi}(\vb{r})                              \\
     & \equiv \frac{1}{2}\iint\dd[3]\vb{r}\dd[3]\vb{r}'
    \widehat{\Psi}^\dagger(\vb{r}')
    \widehat{\tau}_3\left(\xi(\vb{r})\delta(\vb{r}-\vb{r}') + \widehat{\Delta}(\vb{r},\vb{r}')\right)
    \widehat{\Psi}(\vb{r}).
\end{align}
where
\begin{align}
    \widehat{\Delta}(\vb{r},\vb{r}') =
    \begin{pmatrix}
        0                                     & \hat{\Delta}(\vb{r},\vb{r}') \\
        -\hat{\Delta}^\dagger(\vb{r},\vb{r}') & 0
    \end{pmatrix}
\end{align}
When the system is homogeneous, the two-point gap function only depends on the
relative coordinate, i.e., $\hat{\Delta}(\vb{r},\vb{r}') = \hat{\Delta}(\vb{r}-\vb{r}')$.
In this case, we can transform to momentum space, and the Hamiltonian becomes
\begin{equation}
    H = \frac{1}{2}\sum_{\vb{p}}
    \widehat{\Psi}_{\vb{p}}^{\dagger}
    \widehat{\tau}_3(\xi_{\vb{p}} + \widehat{\Delta}(\vb{p}))
    \widehat{\Psi}_{\vb{p}}.
\end{equation}
where
$\widehat{\Psi}_{\vb{p}}^\dagger = (c_{\vb{p}\uparrow}^\dagger, c_{\vb{p}\downarrow}^\dagger, c_{-\vb{p}\uparrow}, c_{-\vb{p}\downarrow})$.

\section{Finite temperature}
The imaginary time Green's function is
\begin{align}
    \widehat{G}(\vb{r}\tau, \vb{r}'\tau')
    = \widehat{G}(\vb{r}, \vb{r}';\tau-\tau')
    = -\ev{T_\tau \widehat{\Psi}(\vb{r}, \tau) \widehat{\Psi}^\dagger(\vb{r}', \tau')}
    \equiv
    \begin{pmatrix}
        \hat{G}             & \hat{F}             \\
        \hat{\underline{F}} & \hat{\underline{G}}
    \end{pmatrix}
\end{align}
The unperturbed Matsubara Green's function is
\begin{align}
    \widehat{G}_0(\vb{p}, i\epsilon_n)
    = (i\epsilon_n - \widehat{\tau}_3\xi_{\vb{p}})^{-1}
    = -\frac{i\epsilon_n + \widehat{\tau}_3\xi_{\vb{p}}}{\epsilon_n^2 + \xi_{\vb{p}}^2}.
\end{align}
In bulk, the Gorkov Green's function satisfies
\begin{align}
    \widehat{G}^{-1}(\vb{p}, i\epsilon_n)
    = \widehat{G}_0^{-1}(\vb{p}, i\epsilon_n) - \widehat{\tau}_3\widehat{\Delta}(\vb{p})
    = i\epsilon_n - \widehat{\tau}_3\xi_{\vb{p}} - \widehat{\tau}_3\widehat{\Delta}(\vb{p}).
\end{align}
which gives
\begin{align}
    \widehat{G}(\vb{p}, i\epsilon_n)
    = - \frac{i\epsilon_n + \widehat{\tau}_3\xi_{\vb{p}} + \widehat{\tau}_3\widehat{\Delta}(\vb{p})}
    {\epsilon_n^2 + \xi_{\vb{p}}^2 + |\Delta|^2}
\end{align}
The bulk quasiclassical Green's function is
\begin{align}
    \widehat{g}(\vb{p}, i\epsilon_n)
    = \int\dd\xi_p \widehat{G}(\vb{p}, i\epsilon_n) \widehat{\tau}_3
    = -\pi \frac{i\epsilon_n\widehat{\tau}_3 - \widehat{\Delta}(\vb{p})}
    {\sqrt{|\Delta|^2 + \epsilon_n^2}}
    = \frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}
    \begin{pmatrix}
        -i\epsilon_n          & \hat{\Delta} \\
        -\hat{\Delta}^\dagger & i\epsilon_n
    \end{pmatrix}
    \equiv
    \begin{pmatrix}
        \hat{g}             & \hat{f}             \\
        \hat{\underline{f}} & \hat{\underline{g}}
    \end{pmatrix}
\end{align}
and it satisfies the normalization condition
\begin{align}
    \widehat{g}(\vb{p}, i\epsilon_n)^2 = -\pi^2\widehat{1}.
\end{align}
The bulk quasiclassical Green's function satisfies
\begin{align}
    \comm{i\epsilon_n\widehat{\tau}_3 - \widehat{\Delta}}{\widehat{g}} = 0
\end{align}
But when near the boundary or impurities, the
quasiclassical Green's function $\widehat{g}(\vb{R},\vb{p};\epsilon)$
and the gap function $\widehat{\Delta}(\vb{R}, \vb{p})$ are
inhomogeneous, and are described by the
Eilenberger equation and gap equation.
\begin{equation}
    \comm{i\epsilon_n\widehat{\tau}_3 - \widehat{\Delta}(\vb{R}, \vb{p})}
    {\widehat{g}(\vb{R},\vb{p};i\epsilon_n)} +
    i\hbar\vb{v}_p \cdot \nabla\widehat{g}(\vb{R},\vb{p};i\epsilon_n)
    = 0
\end{equation}
and
\begin{align}\label{gap_eq}
    \hat{\Delta}(\vb{R}, \vb{p})
    = T\sum_{\epsilon_n=-\omega_c}^{\omega_c}\ev{v(\vb{p}, \vb{p}')
        \hat{f}(\vb{R}, \vb{p}', \epsilon_n)}_{p'}
\end{align}
Here $\vb{R} = \frac{1}{2}(\vb{r} + \vb{r}')$ is the center of the pair.

\section{Current density}
The one-particle density matrix is
\begin{align}
    \rho_{\uparrow\uparrow}(\vb{r}, \vb{r}')
    \equiv \ev{\psi^\dagger_\uparrow(\vb{r}')\psi_\uparrow(\vb{r})}
    = G_{\uparrow\uparrow}(\vb{r}, \vb{r}';0^-)
    = T\sum_{n=-\infty}^{\infty} G_{\uparrow\uparrow}(\vb{r}, \vb{r}';i\epsilon_n)e^{-i\epsilon_n 0^-}
\end{align}
The local current density is
\begin{align} \label{j_eq}
    \vb{j}(\vb{R}) = 2N_fT\sum_n\ev{\vb{v}_p g(\vb{R}, \vb{p}, \epsilon_n)}_{p}
\end{align}
Multiple it by the quasiparticle mass $p_f = m^* v_f$, and we get the mass current density:
\begin{align}
    \vb{j}_m(\vb{R}) \equiv m^*\vb{j}(\vb{R}) = \frac{2N_fv_fp_f}{4}\hbar \times
    \frac{2T}{\xi(T)|\Delta(T)|}\sum_n\ev{\vu{p} g(\vb{R}, \vb{p}, \epsilon_n)}_{p}
\end{align}
where $\xi(T) = \hbar v_f/2|\Delta(T)|$ is the coherence length, and $n = 2N_fp_fv_f$ is the particle density.
The ground state angular momentum in a cylinder is
\begin{align}
    \vb{L} & = \int_0^R \dd[3]r \vb{r} \times \vb{j}_m(\vb{r})            \\
           & = 2\pi h\vu{z}\int_0^R \dd{r} r^2 j_m(r)                     \\
           & \approx 2\pi R^2 h \vu{z}\int_{R-\xi}^R \dd{r} j_m(r)        \\
           & \approx 2V\vu{z} \int_{R-\xi}^R \dd{r} j_m(r)                \\
           & = \frac{N}{2}\hbar \vu{z} \times\frac{2T}{\xi(T)|\Delta(T)|}
    \int_{R-\xi}^R \dd{r} \sum_n\ev{p_y g(\vb{r}, \vb{p}, \epsilon_n)}_{p}
\end{align}

\section{Gap equation}
Now we neglect the spin structure, i.e. discard the little hats.
In bulk, we have
\begin{align}\label{gap_eq_bulk}
    \Delta(\vb{p}) = T\sum_{\epsilon_n=-\omega_c}^{\omega_c}
    \ev{v(\vb{p}, \vb{p}')
        \frac{\pi\Delta(\vb{p}')}{\sqrt{|\Delta|^2 + \epsilon_n^2}}}_{p'}
\end{align}
Move everything to the right hand side and subtract Eq. (\ref{gap_eq}) from it, we get
\begin{align}
    0 = T\sum_{\epsilon_n=-\infty}^{\infty}
    \left[
        \ev{v(\vb{p}, \vb{p}')\frac{f(\vb{R}, \vb{p}', \epsilon_n)}{\Delta(\vb{R}, \vb{p})}}_{p'}
        -
        \ev{v(\vb{p}'', \vb{p}')\frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}\frac{\Delta(\vb{p}')}{\Delta(\vb{p}'')}}_{p'}
        \right]
\end{align}
which gives
\begin{align} \label{gap_iter}
    \Delta(\vb{R}, \vb{p}) =
    \frac{T\sum_{\epsilon_n}^{\infty}\ev{v(\vb{p}, \vb{p}')\hat{f}(\vb{R}, \vb{p}', \epsilon_n)}_{p'}}
    {T\sum_{\epsilon_n}^{\infty}\ev{v(\vb{p}'', \vb{p}')\frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}\frac{\Delta(\vb{p}')}{\Delta(\vb{p}'')}}_{p'}}
\end{align}
We have the Digamma function
\begin{align}
    K(T) = T\sum_{\epsilon_n=-\omega_c}^{\omega_c}
    \frac{\pi}{|\epsilon_n|}\approx\ln{\left(1.13\frac{\omega_c}{T}\right)}
\end{align}
In bulk at $T_c$, we have
\begin{align}
    \Delta(\vb{p}) = K(T_c)
    \ev{v(\vb{p}, \vb{p}')\Delta(\vb{p}')}_{p'}
\end{align}
and we have
\begin{align}
    K(T_c) - K(T) = \ln{\left(T/T_c\right)}
    =\frac{\Delta(\vb{p}'')}{\ev{v(\vb{p}'', \vb{p}')\Delta(\vb{p}')}_{p'}}\eval_{T_c}
    - T\sum_{\epsilon_n=-\omega_c}^{\omega_c}\frac{\pi}{|\epsilon_n|}
\end{align}
Substitute in Eq. (\ref{gap_eq}), we get another equation to determine the gap inhomogeneity:
\begin{align}
    \ln{\frac{T}{T_c}} = T\sum_{\epsilon_n=-\infty}^{\infty}
    \left[
        \frac{\ev{v(\vb{p}, \vb{p}')f(\vb{R}, \vb{p}', \epsilon_n)}_{p'} / \Delta(\vb{R}, \vb{p})}
        {\ev{v(\vb{p}'', \vb{p}')\Delta(\vb{p}')}_{p'}/\Delta(\vb{p}'')\eval_{T_c}}
        - \frac{\pi}{|\epsilon_n|}
        \right]
\end{align}
If you want temperature dependence of bulk gap, you can substitute in Eq. (\ref{gap_eq_bulk}) to get
\begin{align}
    \ln{\frac{T}{T_c}} = T\sum_{\epsilon_n=-\infty}^{\infty}
    \left[
        \frac{\pi\ev{v(\vb{p}, \vb{p}')\Delta(\vb{p}') / \Delta(\vb{p}) \sqrt{|\Delta|^2 + \epsilon_n^2}}_{p'}}
        {\ev{v(\vb{p}'', \vb{p}')\Delta(\vb{p}')}_{p'}/\Delta(\vb{p}'')\eval_{T_c}}
        - \frac{\pi}{|\epsilon_n|}
        \right]
\end{align}

\section{Riccati Parameterizations}
The Riccati parameterization of the Green's function is
\begin{align}
    \widehat{g}
    = -i\pi\widehat{N}
    \begin{pmatrix}
        1+\hat{a}\hat{\underline{a}} & 2\hat{a}                      \\
        -2\hat{\underline{a}}        & -1-\hat{\underline{a}}\hat{a}
    \end{pmatrix}
\end{align}
where $\widehat{N}$ is
\begin{align}
    \widehat{N} =
    \begin{pmatrix}
        (1-\hat{a}\hat{\underline{a}})^{-1} & 0                                   \\
        0                                   & (1-\hat{\underline{a}}\hat{a})^{-1}
    \end{pmatrix}
\end{align}
The inverse is
\begin{align}
    \hat{a} = (\hat{g}-i\pi)^{-1}\hat{f} \\
    \hat{\underline{a}} = (\hat{\underline{g}}+i\pi)^{-1}\hat{\underline{f}}
\end{align}
Substitute in the bulk Green's function to get the bulk Ricatti amplitude:
\begin{align}
    \hat{a} = \frac{-\hat{\Delta}}{i\epsilon_n + i\sqrt{|\Delta|^2 + \epsilon_n^2}} \\
    \hat{\underline{a}} = \frac{-\hat{\Delta}^\dagger}{i\epsilon_n + i\sqrt{|\Delta|^2 + \epsilon_n^2}}
\end{align}
The matrix Ricatti equation is
\begin{align}
    i\hbar\vb{v}_p \vdot \grad{\hat{a}} + 2i\epsilon_n\hat{a}
    + \hat{a}\hat{\Delta}^\dagger\hat{a} + \hat{\Delta} = 0 \\
    i\hbar\vb{v}_p \vdot \grad{\hat{\underline{a}}} - 2i\epsilon_n\hat{\underline{a}}
    - \hat{\underline{a}}\hat{\Delta}\hat{\underline{a}} - \hat{\Delta}^\dagger = 0
\end{align}

\section{$^3$He-A}
For $^3$He-A, the spin structure is $\vu{d}\vdot(i\va{\sigma}\hat{\sigma}_y) = \hat{\sigma}_x$,
and we have two components of the gap function,
\begin{align}
    \hat{\Delta}(\vb{R}, \vb{p})
    = \hat{\sigma}_x (\Delta_1(\vb{R})p_x + \Delta_2(\vb{R})p_y)
\end{align}
In bulk we have
$\hat{\Delta}(\vb{R}, \vb{p}) = \hat{\sigma}_x \Delta(p_x + ip_y) = \hat{\sigma}_x \Delta e^{i\phi_p}$.
The interaction is $v(\vb{p}, \vb{p}') = 3v_0\vu{p}\vdot\vu{p}'$. Note that
\begin{align}
    \frac{1}{2\pi}\int_0^{2\pi} \dd\phi \cos\phi e^{i\phi} = \frac{1}{2}
\end{align}
In 2d case ($|\Delta|^2$ does not depend on $\vb{p}$), Eq. (\ref{gap_iter}) becomes
\begin{align}
    \Delta(\vb{R}, \vb{p}) =
    \frac{2\sum_{\epsilon_n}^{\infty}\ev{\vb{p}\vdot\vb{p}'f(\vb{R}, \vb{p}', \epsilon_n)}_{p'}}
    {\sum_{\epsilon_n}^{\infty}\frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}}
\end{align}
The 2d bulk gap equation is
\begin{align}
    \ln{\frac{T}{T_c}} = T\sum_{\epsilon_n=-\infty}^{\infty}
    \left[
        \frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}
        - \frac{\pi}{|\epsilon_n|}
        \right]
\end{align}

\section{s-wave pairing}
For s-wave pairing, the spin structure is $i\hat{\sigma}_y$, and we have
\begin{align}
    \hat{\Delta}(\vb{R}, \vb{p})
    = i\hat{\sigma}_y \Delta(\vb{R})
\end{align}
In bulk we have $\hat{\Delta}(\vb{R}, \vb{p}) = i\hat{\sigma}_y \Delta$.
The interaction is $v(\vb{p}, \vb{p}') = v_s$, and Eq. (\ref{gap_iter}) reduces to
\begin{align}
    \Delta(\vb{R}) =
    \frac{\sum_n \ev{f(\vb{R}, \vb{p}', \epsilon_n)}_{p'}}
    {\sum_n \frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}}
\end{align}

\section{$^3$He-A edge gap profile}
We assume translational invariance along the edge, i.e. the $y$ direction.
We also assume the gap to be real(imaginary) along the $p_x(p_y)$ direction.
\begin{align}
    \hat{\Delta}(x, \vb{p})
    = \hat{\sigma}_x (\Delta_1(x)p_x + i\Delta_2(x)p_y)
\end{align}
Here $\Delta_1(x)$ and $\Delta_2(x)$ are real functions, and we have
\begin{align}
    \widehat{\Delta}(x, \vb{p})
     & =
    \begin{pmatrix}
        0                                                  & \hat{\sigma}_x (\Delta_1(x)p_x + i\Delta_2(x)p_y) \\
        -\hat{\sigma}_x (\Delta_1(x)p_x - i\Delta_2(x)p_y) & 0
    \end{pmatrix} \\
     & = i\hat{\sigma}_x(\Delta_2p_y\widehat{\tau}_1 + \Delta_1p_x\widehat{\tau}_2)
\end{align}
We can also write the anomalous Green's function as
\begin{align}
    \hat{f}(\vb{R}, \vb{p}, \epsilon_n)
    = \hat{\sigma}_x \bigg(f_1(\vb{R}, \vb{p}, \epsilon_n) + if_2(\vb{R}, \vb{p}, \epsilon_n) \bigg) \\
    \hat{\underline{f}}(\vb{R}, \vb{p}, \epsilon_n)
    = -\hat{\sigma}_x \bigg(f_1(\vb{R}, \vb{p}, \epsilon_n) - if_2(\vb{R}, \vb{p}, \epsilon_n) \bigg)
\end{align}
where $f_{1,2}$ are complex functions, and we have
\begin{align}
    \widehat{g}
    = \hat{g}\widehat{\tau}_3 + i\hat{\sigma}_x(f_2\widehat{\tau}_1 + f_1\widehat{\tau}_2)
\end{align}
and
\begin{align}
    f_1 = \frac{f - \underline{f}}{2} \qq{and}
    f_2 = \frac{f + \underline{f}}{2i}
\end{align}
In this case, we can even write the gap equation as
\begin{align}
    \Delta_{1,2}(x) = T\sum_{\epsilon_n=-\omega_c}^{\omega_c}\ev{v(\vb{p}_{x,y}, \vb{p}')
        f_{1,2}(x, \vb{p}', \epsilon_n)}_{p'}
\end{align}
and the gap iteration becomes
\begin{align}
    \Delta_{1,2}(x) =
    \frac{2\sum_n \ev{\vb{p}_{x,y}\vdot\vb{p}'f_{1,2}(x, \vb{p}', n)}_{p'}}
    {\sum_n \frac{\pi}{\sqrt{|\Delta|^2 + \epsilon_n^2}}}
\end{align}

\subsection{Numerical solution}
The bulk gap temperature dependence is
\begin{align}
    \ln{t} = \pi t\sum_{n=-\infty}^{\infty}
    \left[
        \frac{1}{\sqrt{\delta(t)^2 + e_n^2}}
        - \frac{1}{|e_n|}
        \right]
\end{align}
The dimensionless iteration of the gap function is
\begin{align}
    \delta_{1,2}(x) =
    \frac{2\sum_n \ev{\vb{p}_{x,y}\vdot\vb{p}'f_{1,2}(x, \vb{p}', n)}_{p'}}
    {\sum_n \frac{\pi}{\sqrt{1 + e_n^2/\delta(t)^2}}}
\end{align}
where $t = T/T_c$, $\delta_{1,2}(x) = \Delta_{1,2}(x)/|\Delta(T)|$,
$e_n = \epsilon_n/T_c$ and $\delta(t) = |\Delta(T)|/T_c$.
The Ricatti equation is
\begin{align}
    i\partial_x a(\vb{p},x) + \frac{ie_n}{\delta(t)}a(\vb{p},x)
    + \frac{\delta^*(\vb{p},x)}{2} a^2(\vb{p},x) + \frac{\delta(\vb{p},x)}{2} = 0 \\
    i\partial_x \underline{a}(\vb{p},x) - \frac{ie_n}{\delta(t)} \underline{a}(\vb{p},x)
    - \frac{\delta(\vb{p},x)}{2}\underline{a}^2(\vb{p},x) - \frac{\delta^*(\vb{p},x)}{2} = 0
\end{align}
where $\xi = \hbar v_f/2|\Delta(T)|$,
and $\partial_x = p_x\xi\nabla_x$. The $p_x$ can be interpreted as the
projection of quasiparticle trajectory along the $x$ direction.
We can get $g$ and $f_{1,2}$ from
\begin{align}
    g = -i\pi\frac{1+a\underline{a}}{1-a\underline{a}} \\
    f = f_1 + if_2 = -i\pi\frac{2a}{1-a\underline{a}}
\end{align}

We first assume an initial guess for the gap function $\delta(\vb{r}, \vu{p})$.
For each trajectory $\vu{p}$ along which the quasiparticle propagates, we can
solve the Eilenberger equation to get the Green's function $g(\vb{r}, \vu{p}, n)$
and the anomalous Green's function $f(\vb{r}, \vu{p}, n)$. Then we iterate to
update the gap function $\delta(\vb{r}, \vu{p})$ by solving the gap equation.
Repeat until convergence.

\section{4-th order Runge-Kutta method}
We can use the 4-th order Runge-Kutta method to solve the Riccati equation.
\begin{align}
    \partial_x a(\vb{p}, x) = i
    \left(
    \frac{ie_n}{\delta(t)}a(\vb{p},x)
    + \frac{\delta_1(x)p_x - i\delta_2(x)p_y}{2} a^2(\vb{p},x)
    + \frac{\delta_1(x)p_x + i\delta_2(x)p_y}{2}
    \right) \\
    \partial_x \underline{a}(\vb{p}, x) = -i
    \left(
    \frac{ie_n}{\delta(t)} \underline{a}(\vb{p},x)
    + \frac{\delta_1(x)p_x + i\delta_2(x)p_y}{2} \underline{a}^2(\vb{p},x)
    + \frac{\delta_1(x)p_x - i\delta_2(x)p_y}{2}
    \right)
\end{align}
For an ODE
\begin{align}
    \dv{a}{x} = f(x, a)
\end{align}
when step size is $h$, RK4 method gives
\begin{align}
    k_1     & = f\left(x_n, a_n\right)                                \\
    k_2     & = f\left(x_n + \frac{h}{2}, a_n + \frac{h}{2}k_1\right) \\
    k_3     & = f\left(x_n + \frac{h}{2}, a_n + \frac{h}{2}k_2\right) \\
    k_4     & = f\left(x_n + h, a_n + hk_3\right)                     \\
    a_{n+1} & = a_n + \frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)
\end{align}
When iteratively solving the Ricatti equation and the gap equation,
we can interpolate the gap function to get the half step value
$\delta_{1,2}(x_n + h/2)$.

\section{Analytic Continuation}
For the integration contour $C$ being an infinite circle,
assume function $g(z)$ has no poles inside the contour and vanishes at infinity,
the residue theorem gives
\begin{align}
    \oint_C \dd z n_F(z) g(z)
    = 2\pi i \sum_\text{poles} \Res{n_F(z) g(z)}
    = 2\pi i \left(-T\right) \sum_{n=-\infty}^{\infty} g(\epsilon_n)
\end{align}
The residue of the Fermi distribution function $\Res{n_F(z)} = -T$.
We can seperate the contour into upper and lower half circles, which gives
\begin{align}
    \oint_C \dd z n_F(z) g(z)
     & = \left(\oint_\text{upper} + \oint_\text{lower}\right) \dd z n_F(z) g(z)                                    \\
     & = \int_{-\infty}^{\infty}\dd\epsilon n_F(\epsilon) g^R(\epsilon+i0^+)
    + \int_{\infty}^{-\infty}\dd\epsilon n_F(\epsilon) g^A(\epsilon-i0^+)                                          \\
     & = \int_{-\infty}^{\infty}\dd\epsilon n_F(\epsilon) \left[g^R(\epsilon + i0^+) - g^A(\epsilon - i0^+)\right] \\
     & = \int_{-\infty}^{\infty}\dd\epsilon n_F(\epsilon)2i\Im{g^R(\epsilon + i0^+)}
\end{align}
and we get
\begin{align}
    T\sum_{n=-\infty}^{\infty} g(\epsilon_n)
    = \int_{-\infty}^{\infty}\dd\epsilon n_F(\epsilon)\left(-\frac{1}{\pi}\Im{g^R(\epsilon + i0^+)}\right)
\end{align}
Analytically continue Eq. (\ref{j_eq}) to real frequency, we get
\begin{align}
    \vb{j}(\vb{R})=2N_f\int\dd\epsilon n_F(\epsilon)
    \ev{\vb{v}_p \left(-\frac{1}{\pi}\Im{g(\vb{R}, \vb{p}, \epsilon)}\right)}_p
\end{align}

\end{document}